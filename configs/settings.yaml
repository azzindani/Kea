# Application Settings
app:
  name: "Kea Research Engine"
  version: "0.1.0"
  environment: "${ENVIRONMENT:development}"

# Logging Configuration
logging:
  level: "${LOG_LEVEL:INFO}"
  format: "${LOG_FORMAT:json}"
  service_name: "research-engine"

# LLM Configuration
llm:
  default_provider: "openrouter"
  default_model: "${OPENROUTER_MODEL:nvidia/nemotron-3-nano-30b-a3b:free}"
  temperature: 0.7
  max_tokens: 16384
  enable_reasoning: true

# Embedding Configuration (Priority: Local -> API Fallback)
embedding:
  use_local: true
  model_name: "Qwen/Qwen3-Embedding-0.6B"
  api_model: "qwen/qwen3-embedding-8b"
  dimension: 1024
  batch_size: 32

# Reranker Configuration
reranker:
  model_name: "Qwen/Qwen3-Reranker-0.6B"
  per_task_top_k: 32768
  final_batch_top_k: 32768
  max_length: 32768

# MCP Servers Configuration
mcp:
  # Just-In-Time Spawning Config
  jit:
    enabled: true
    uv_enabled: true
    idle_timeout: 300  # 5 minutes
    max_servers: 20
  
  servers:
    - name: "scraper_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with playwright --with beautifulsoup4 --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.scraper_server.server"
    - name: "python_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with pandas --with duckdb --with yfinance --with scikit-learn --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.python_server.server"
    - name: "search_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with httpx --with duckduckgo-search --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.search_server.server"
    - name: "academic_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with httpx --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.academic_server.server"
    - name: "analytics_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with pandas --with numpy --with scipy --with scikit-learn --with ydata-profiling --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.analytics_server.server"
    - name: "browser_agent_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with httpx --with beautifulsoup4 --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.browser_agent_server.server"
    - name: "crawler_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with httpx --with beautifulsoup4 --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.crawler_server.server"
    - name: "data_sources_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with pandas --with yfinance --with fredapi --with wbgapi --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.data_sources_server.server"
    - name: "document_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with httpx --with pymupdf --with python-docx --with pandas --with openpyxl --with beautifulsoup4 --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.document_server.server"
    - name: "ml_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with pandas --with numpy --with scikit-learn --with scipy --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.ml_server.server"
    - name: "qualitative_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.qualitative_server.server"
    - name: "regulatory_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with httpx --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.regulatory_server.server"
    - name: "security_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with httpx --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.security_server.server"
    - name: "tool_discovery_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with httpx --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.tool_discovery_server.server"
    - name: "visualization_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with pandas --with plotly --with numpy --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.visualization_server.server"
    - name: "vision_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with httpx --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.vision_server.server"
    
    # === Financial Data Servers ===
    - name: "yfinance_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with yfinance --with pandas --with matplotlib --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.yfinance_server.server"
    - name: "yahooquery_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with yahooquery --with pandas --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.yahooquery_server.server"
    - name: "ccxt_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with ccxt --with pandas --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.ccxt_server.server"
    - name: "tradingview_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with tradingview-ta --with pandas --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.tradingview_server.server"
    
    # === Technical Analysis Servers ===
    - name: "pandas_ta_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with pandas-ta --with pandas --with numpy --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.pandas_ta_server.server"
    - name: "finta_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with finta --with pandas --with numpy --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.finta_server.server"
    - name: "mibian_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with mibian --with numpy --with scipy --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.mibian_server.server"
    
    # === Market Data Servers ===
    - name: "finviz_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with finviz --with pandas --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.finviz_server.server"
    - name: "pdr_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with pandas-datareader --with pandas --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.pdr_server.server"
    - name: "wbgapi_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with wbgapi --with pandas --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.wbgapi_server.server"
    
    # === SEC/EDGAR Servers ===
    - name: "sec_edgar_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with sec-edgar-downloader --with httpx --with beautifulsoup4 --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.sec_edgar_server.server"
    - name: "python_edgar_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with python-edgar --with pandas --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.python_edgar_server.server"
    
    # === Specialized Servers ===
    - name: "newspaper_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with newspaper3k --with lxml --with nltk --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.newspaper_server.server"
    - name: "web3_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with web3 --with eth-abi --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.web3_server.server"
    - name: "analysis_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with pandas --with numpy --with scipy --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.analysis_server.server"
    - name: "filesystem_server"
      enabled: true
      transport: "stdio"
      command: "uv run --with wrapt --with pydantic --with structlog --with python-dotenv python -m mcp_servers.filesystem_server.server"

# Research Configuration
research:
  max_depth: 5
  max_sources: 50
  timeout_seconds: 300
  parallel_tools: 10

# Rate Limiting
rate_limits:
  default:
    requests_per_minute: 60
    requests_per_hour: 1000
  domains:
    "*.gov.id":
      requests_per_minute: 10
      delay_seconds: 2

# ============================================================================
# Deep Audit Configs (Added during Refactoring)
# ============================================================================

# Model Identity Configuration
models:
  # The default model for most tasks
  default_model: "nvidia/nemotron-3-nano-30b-a3b:free"
  app_name: "Kea Research Engine"
  
  # Specialized models (can be same as default)
  planner_model: "nvidia/nemotron-3-nano-30b-a3b:free"
  critic_model: "nvidia/nemotron-3-nano-30b-a3b:free"
  generator_model: "nvidia/nemotron-3-nano-30b-a3b:free"

# Governance & Safety
governance:
  max_concurrent_cost: 100  # "Points" for rate limiting
  max_ram_percent: 85.0     # Pause dispatch if RAM > 85%
  max_cpu_percent: 90.0     # Pause dispatch if CPU > 90%
  poll_interval: 1.0        # Supervisor check interval in seconds

# Standardized Timeouts
timeouts:
  default: 30.0
  llm_completion: 60.0
  llm_streaming: 120.0
  tool_execution: 300.0
  long: 600.0

# Loop Safety Controls
loop_safety:
  max_global_iterations: 20
  max_facts_threshold: 500
