# Kernel Behavioral Configuration
# All numeric thresholds, retry policy, and defaults used by the orchestrator kernel.
# Edit here to tune behavior without touching Python source.

execution:
  min_valid_output_length: 5        # Minimum chars for a tool output to count as valid
  error_short_content_max: 200      # Content shorter than this + error term → treat as error
  error_early_position_max: 100     # Error term appearing before this char pos → treat as error
  citation_preview_length: 500      # Max chars kept in tool citation result_preview
  fact_rerank_truncation: 8000      # Max chars of each fact sent to reranker
  report_max_facts: 10              # Max facts listed in final synthesizer report
  report_max_invocations: 25        # Max tool invocations shown in source table
  report_max_sources_fallback: 10   # Fallback source list length when no citations
  max_agentic_tools: 50             # Max tools passed to agentic workflow context

retry:
  base_retries: 5                   # Default max retries for tool execution
  cpu_scale_min: 3                  # Minimum retries regardless of CPU count
  cpu_scale_max: 8                  # Maximum retries regardless of CPU count
  cpu_scale_divisor: 2              # Retries = clamp(cpu_count // divisor, min, max)

defaults:
  max_revisions: 2                  # Max Generator revision loops before forced finalize
  max_parallel_fallback: 6          # Parallel workers when complexity info unavailable
  fallback_tool: web_search         # Default tool when no plan is available

llm_callbacks:
  planner_temperature: 0.3          # Temperature for internal LLM callbacks (parameter corrector, spawner)
  planner_max_tokens: 32768         # Max tokens for internal LLM callbacks

# ==============================================================================
# Kernel Cell v1.0 Configuration
# ==============================================================================

kernel_cell:
  # Token Budget Defaults
  budget:
    default_max_tokens: 30000
    simple_query_budget: 5000
    complex_query_budget: 50000
    min_child_budget: 1000
    reserve_for_synthesis: 2000

  # Recursion Limits
  recursion:
    max_depth: 5
    max_children_per_cell: 8
    max_steps_per_cell: 15

  # Quality Gates Per Level
  quality_gates:
    intern:   { min_accuracy: 0.55, min_composite: 0.45, max_retries: 3 }
    staff:    { min_accuracy: 0.65, min_composite: 0.55, max_retries: 2 }
    manager:  { min_accuracy: 0.70, min_composite: 0.60, max_retries: 1 }
    director: { min_accuracy: 0.75, min_composite: 0.65, max_retries: 1 }
    vp:       { min_accuracy: 0.80, min_composite: 0.70, max_retries: 1 }
    ceo:      { min_accuracy: 0.85, min_composite: 0.75, max_retries: 0 }

  # Score Dimension Weights
  scoring:
    accuracy: 0.25
    completeness: 0.18
    relevance: 0.18
    depth: 0.13
    novelty: 0.06
    coherence: 0.10
    actionability: 0.10

  # Aggregation Weights for Hierarchical Roll-up
  aggregation:
    children_weight: 0.50
    review_weight: 0.30
    integration_weight: 0.20

  # Knowledge Retrieval
  knowledge:
    default_skill_limit: 3
    default_rule_limit: 2
    default_procedure_limit: 2

  # Consensus Rounds Per Level
  consensus:
    staff_rounds: 0
    manager_rounds: 1
    director_rounds: 2
    vp_rounds: 2
    ceo_rounds: 3

  # Quality Bar Instructions (injected into every LLM call by inference engine)
  quality_instructions:
    draft: >
      QUALITY: DRAFT — Prioritize speed and coverage over polish.
      Incomplete data is acceptable — flag gaps clearly.
    professional: >
      QUALITY: PROFESSIONAL — Deliver thorough, well-structured, verified output.
      Cross-reference data points. Cite sources.
    executive: >
      QUALITY: EXECUTIVE — Deliver boardroom-ready output: precise language,
      no filler, actionable insights, quantified claims,
      risk-aware recommendations with confidence levels.

  # Maps existing ComplexityTier → ProcessingMode (used by _assess_complexity)
  complexity_mode_mapping:
    trivial: direct
    low: solo
    medium: solo
    high: delegate
    extreme: hierarchy
